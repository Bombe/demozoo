{% extends "base.html" %}
{% load safe_markdown %}
{% load demoscene_tags %}

{% block body_class %}show_production{% endblock %}

{% block base_main %}
	<div class="panel">
		<ul class="actions">
			{% if editing %}
				<li><a href="{% url edit_production_done production.id %}" class="done">Done</a></li>
			{% else %}
				<li><a href="{% url edit_production production.id %}" class="edit">Edit</a></li>
			{% endif %}
		</ul>
		
		<div class="production_title">
			<h2>{{ production.title }}</h2>
			{% if production.author_nicks.all %}
				<h3>
					by {% byline production %}
				</h3>
			{% endif %}
			
			{% if editing %}
				<a href="{% url production_edit_core_details production.id %}" class="open_in_lightbox">
					<img src="/static/images/icons/edit.png" width="16" height="16" alt="Edit production details" title="Edit production details" />
				</a>
			{% endif %}
		</div>
		
		{% if screenshots or editing %}
			<div class="screenshots">
				{% if screenshots %}
					{% with screenshots.0 as pic %}
						<a href="{{ pic.original.url }}" target="_blank" class="open_image_in_lightbox" id="main_image">
							<img src="{{ pic.standard.url }}" width="{{ pic.standard_width }}" height="{{ pic.standard_height }}" alt="" />
						</a>
					{% endwith %}
					{% if screenshots.count > 1 %}
						<ul>
							{% for pic in screenshots %}
								<li>
									<a href="{{ pic.original.url }}" target="_blank" class="replace_main_image" data-original-image="{{ pic.original.url }}" data-main-image="{{ pic.standard.url }}" data-main-image-width="{{ pic.standard_width }}" data-main-image-height="{{ pic.standard_height }}">
										<img src="{{ pic.thumbnail.url }}" width="{{ pic.thumbnail_width }}" height="{{ pic.thumbnail_height }}" alt="" />
									</a>
								</li>
							{% endfor %}
						</ul>
					{% endif %}
				{% endif %}
				{% if editing %}
					<ul class="actions">
						<li>
							<a href="{% url production_add_screenshot production.id %}" class="add open_in_lightbox">Add screenshot</a>
						</li>
					</ul>
				{% endif %}
			</div>
		{% endif %}
		
		<div class="production_details">
			{% if production.release_date or editing %}
				<p>Release date: {% if production.release_date %}{{ production.release_date }}{% else %}<em>not set</em>{% endif %}</p>
			{% endif %}
			
			<ul>
				{% for production_type in production.types.all %}
					<li>{{ production_type.name }}</li>
				{% endfor %}
			</ul>
			
			<ul>
				{% for platform in production.platforms.all %}
					<li>{{ platform.name }}</li>
				{% endfor %}
			</ul>
			
			{% if production.has_any_external_links or editing_as_admin %}
				<div class="external_links">
					<h3>External links:</h3>
					<ul>
						{% if production.pouet_id %}<li><a href="{{ production.pouet_url }}" class="pouet" title="{{ production.title }} on Pouët">Pouët</a></li>{% endif %}
						{% if production.csdb_id %}<li><a href="{{ production.csdb_url }}" class="csdb" title="{{ production.title }} on CSDb">CSDb</a></li>{% endif %}
						{% if production.bitworld_id %}<li><a href="{{ production.bitworld_url }}" class="bitworld" title="{{ production.title }} on Bitworld">Bitworld</a></li>{% endif %}
						{% if editing_as_admin %}<li><a href="{% url production_edit_external_links production.id %}" class="edit open_in_lightbox">Edit</a></li>{% endif %}
					</ul>
				</div>
			{% endif %}
		</div>
		
		<div style="clear: both;"></div>
	</div>
	
	{% if production.notes or editing_as_admin %}
		<div class="notes">
			{% if editing_as_admin %}
				<ul class="actions">
					<li><a class="edit open_in_lightbox" href="{% url production_edit_notes production.id %}">Edit notes</a></li>
				</ul>
			{% endif %}
			{{ production.notes|safe_markdown }}
			<div style="clear: both;"></div>
		</div>
	{% endif %}
	
	{% if credits or editing %}
		<div class="panel">
			<h3>Credits</h3>
			<ul>
				{% for credit in credits %}
					<li>
						<a href="{{ credit.nick.releaser.get_absolute_url }}">{{ credit.nick }}</a>
						{% if credit.role %}
							- {{ credit.role }}
						{% endif %}
						{% if editing %}
							<a href="{% url production_edit_credit production.id credit.id %}" class="open_in_lightbox">
								<img src="/static/images/icons/edit.png" width="16" height="16" alt="Edit credit" title="Edit credit" />
							</a>
						{% endif %}
					</li>
				{% endfor %}
				{% if editing %}
					<li class="add">
						<a href="{% url production_add_credit production.id %}" class="open_in_lightbox">Add credit</a>
					</li>
				{% endif %}
			</ul>
		</div>
	{% endif %}
	
	{% if download_links or editing %}
		<div class="panel">
			<h3>Downloads</h3>
			<ul class="download_links">
				{% for link in download_links %}
					<li class="download_link {% firstof link.host_identifier '' %}">
						<a href="{{ link.url }}">download {% if link.hostname %}({{ link.hostname }}){% endif %}</a>
						{% if editing %}
							<a href="{% url production_edit_download_link production.id link.id %}" class="open_in_lightbox">
								<img src="/static/images/icons/edit.png" width="16" height="16" alt="Edit download link" title="Edit download link" />
							</a>
						{% endif %}
					</li>
				{% endfor %}
				{% if editing %}
					<li class="add">
						<a href="{% url production_add_download_link production.id %}" class="open_in_lightbox">Add download link</a>
					</li>
				{% endif %}
			</ul>
		</div>
	{% endif %}
{% endblock %}
